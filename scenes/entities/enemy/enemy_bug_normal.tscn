[gd_scene load_steps=36 format=3 uid="uid://likipnxqlyh0"]

[ext_resource type="Script" path="res://scripts/entities/enemy/enemy_bug/enemy_bug_m.gd" id="1_rq7rq"]
[ext_resource type="Shader" path="res://shaders/sprite_flash.gdshader" id="1_x5mme"]
[ext_resource type="Texture2D" uid="uid://boudiupl1jv8x" path="res://textures/entity/enemy/bug_normal.png" id="1_yo8ks"]
[ext_resource type="Texture2D" uid="uid://mleldnpwtv13" path="res://textures/entity/shadow_small.png" id="2_g4b4i"]
[ext_resource type="Script" path="res://scripts/entities/components/hitbox_component.gd" id="2_lqi5o"]
[ext_resource type="AudioStream" uid="uid://d0x245xgxq0kc" path="res://audio/assets/entities/enemy/enemy_bugrobot/Charge/BugRobot_Charge_00.wav" id="3_1cqe3"]
[ext_resource type="Script" path="res://scripts/entities/components/health_component.gd" id="3_10cob"]
[ext_resource type="AudioStream" uid="uid://vkjnxehbg3vv" path="res://audio/assets/entities/enemy/enemy_bugrobot/Charge/BugRobot_Charge_01.wav" id="4_m77rb"]
[ext_resource type="Script" path="res://scripts/player/states/state_machine/state_machine.gd" id="5_gf3mp"]
[ext_resource type="AudioStream" uid="uid://dtxsfcj4x2oqi" path="res://audio/assets/entities/enemy/enemy_bugrobot/Charge/BugRobot_Charge_02.wav" id="5_o5inv"]
[ext_resource type="Script" path="res://scripts/entities/enemy/enemy_bug/states/en_bug_idle_state.gd" id="6_kipva"]
[ext_resource type="AudioStream" uid="uid://bi3n3xjj1vwnb" path="res://audio/assets/entities/enemy/enemy_bugrobot/Charge/BugRobot_Charge_03.wav" id="6_us1xn"]
[ext_resource type="AudioStream" uid="uid://nrx3if248vbt" path="res://audio/streams/enemies/enemy_damaged.tres" id="7_0jtrg"]
[ext_resource type="Script" path="res://scripts/entities/enemy/enemy_bug/states/en_bug_run_state.gd" id="7_o2yoh"]
[ext_resource type="Script" path="res://scripts/entities/enemy/enemy_bug/states/en_bug_charge_state.gd" id="8_le7xn"]
[ext_resource type="AudioStream" uid="uid://cpcg4lvhrrlw8" path="res://audio/assets/entities/enemy/enemy_bugrobot/Leap/BugRobot_Leap_00.wav" id="8_wrgb1"]
[ext_resource type="AudioStream" uid="uid://gt0taay6wua8" path="res://audio/assets/entities/enemy/enemy_bugrobot/Leap/BugRobot_Leap_01.wav" id="9_jibkn"]
[ext_resource type="Script" path="res://scripts/entities/enemy/enemy_bug/states/en_bug_leap_state.gd" id="9_ofy2y"]
[ext_resource type="AudioStream" uid="uid://ddfcyrtym70lr" path="res://audio/assets/entities/enemy/enemy_bugrobot/Leap/BugRobot_Leap_02.wav" id="10_5g3lc"]
[ext_resource type="AudioStream" uid="uid://c3t0cvpuqn03b" path="res://audio/assets/entities/enemy/enemy_bugrobot/Leap/BugRobot_Leap_03.wav" id="11_jg8ys"]
[ext_resource type="Script" path="res://scripts/entities/enemy/enemy_bug/states/en_bug_dead.gd" id="12_kj0bm"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_cbiq8"]
resource_local_to_scene = true
shader = ExtResource("1_x5mme")
shader_parameter/enabled = false

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_dflxb"]
random_pitch = 1.5
random_volume_offset_db = 0.5
streams_count = 4
stream_0/stream = ExtResource("3_1cqe3")
stream_0/weight = 1.0
stream_1/stream = ExtResource("4_m77rb")
stream_1/weight = 1.0
stream_2/stream = ExtResource("5_o5inv")
stream_2/weight = 1.0
stream_3/stream = ExtResource("6_us1xn")
stream_3/weight = 1.0

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_ipx71"]
random_pitch = 1.2
random_volume_offset_db = 2.0
streams_count = 4
stream_0/stream = ExtResource("8_wrgb1")
stream_0/weight = 1.0
stream_1/stream = ExtResource("9_jibkn")
stream_1/weight = 1.0
stream_2/stream = ExtResource("10_5g3lc")
stream_2/weight = 1.0
stream_3/stream = ExtResource("11_jg8ys")
stream_3/weight = 1.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_hacv6"]
size = Vector2(12, 8)

[sub_resource type="Animation" id="Animation_5c05m"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_7ysd7"]
resource_name = "charge"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 1,
"values": [11, 12, 13, 14, 15]
}

[sub_resource type="Animation" id="Animation_eacmg"]
resource_name = "death"
length = 0.4
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [20, 21, 22, 23]
}

[sub_resource type="Animation" id="Animation_mbju5"]
resource_name = "idle"
length = 2.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_1uiwn"]
resource_name = "leap"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [16, 17, 18, 19]
}

[sub_resource type="Animation" id="Animation_thprx"]
resource_name = "run"
length = 0.6
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 1,
"values": [5, 6, 7, 8, 9, 10]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_vvenw"]
_data = {
"RESET": SubResource("Animation_5c05m"),
"charge": SubResource("Animation_7ysd7"),
"death": SubResource("Animation_eacmg"),
"idle": SubResource("Animation_mbju5"),
"leap": SubResource("Animation_1uiwn"),
"run": SubResource("Animation_thprx")
}

[sub_resource type="RectangleShape2D" id="RectangleShape2D_0ca7u"]
size = Vector2(12, 8)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_j5ocy"]
size = Vector2(2.5, 8)

[sub_resource type="CircleShape2D" id="CircleShape2D_q1848"]
radius = 8.0

[node name="enemy_bug_normal" type="CharacterBody2D" node_paths=PackedStringArray("health_component")]
material = SubResource("ShaderMaterial_cbiq8")
collision_layer = 128
script = ExtResource("1_rq7rq")
move_speed = 40.0
chase_speed = 80.0
min_rand_move_distance = 50.0
max_rand_move_distance = 180.0
leap_distance = 50
leap_speed = 190.0
charge_sound = SubResource("AudioStreamRandomizer_dflxb")
damaged_sound = ExtResource("7_0jtrg")
leap_sound = SubResource("AudioStreamRandomizer_ipx71")
enemy_name = "Bug"
health_component = NodePath("HealthComponent")

[node name="shadow" type="Sprite2D" parent="."]
self_modulate = Color(1, 1, 1, 0.243137)
position = Vector2(-4.76837e-07, 2)
scale = Vector2(1.125, 1)
texture = ExtResource("2_g4b4i")

[node name="Sprite2D" type="Sprite2D" parent="."]
use_parent_material = true
texture = ExtResource("1_yo8ks")
hframes = 24

[node name="HitboxComponent" type="Area2D" parent="."]
collision_layer = 1024
collision_mask = 16
script = ExtResource("2_lqi5o")

[node name="CollisionShape2D" type="CollisionShape2D" parent="HitboxComponent"]
shape = SubResource("RectangleShape2D_hacv6")

[node name="HealthComponent" type="Node" parent="." node_paths=PackedStringArray("hitbox_component")]
script = ExtResource("3_10cob")
hitbox_component = NodePath("../HitboxComponent")
max_health = 6

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_vvenw")
}
autoplay = "idle"

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_0ca7u")

[node name="StateMachine" type="Node" parent="."]
script = ExtResource("5_gf3mp")
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateMachine"]
script = ExtResource("6_kipva")

[node name="Run" type="Node" parent="StateMachine"]
script = ExtResource("7_o2yoh")

[node name="Charge" type="Node" parent="StateMachine"]
script = ExtResource("8_le7xn")

[node name="Leap" type="Node" parent="StateMachine"]
script = ExtResource("9_ofy2y")

[node name="Dead" type="Node" parent="StateMachine"]
script = ExtResource("12_kj0bm")

[node name="obstacle_detection" type="ShapeCast2D" parent="."]
shape = SubResource("RectangleShape2D_j5ocy")
target_position = Vector2(32, 0)
max_results = 16
collision_mask = 17
collide_with_areas = true

[node name="player_detection" type="RayCast2D" parent="."]
target_position = Vector2(0, 0)
collision_mask = 3

[node name="change_turn_dir" type="Timer" parent="."]
one_shot = true

[node name="charge_to_leap_delay" type="Timer" parent="."]

[node name="attack_area" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 2
monitorable = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="attack_area"]
shape = SubResource("CircleShape2D_q1848")

[node name="hit_shader_cooldown" type="Timer" parent="."]

[connection signal="area_entered" from="HitboxComponent" to="HitboxComponent" method="_on_area_entered"]
[connection signal="damage_taken" from="HealthComponent" to="." method="_on_health_component_damage_taken"]
[connection signal="dead" from="HealthComponent" to="." method="_on_health_component_dead"]
[connection signal="animation_finished" from="AnimationPlayer" to="StateMachine/Charge" method="_on_animation_player_animation_finished"]
[connection signal="timeout" from="change_turn_dir" to="." method="_on_change_turn_dir_timeout"]
[connection signal="body_entered" from="attack_area" to="StateMachine/Leap" method="_on_attack_area_body_entered"]
[connection signal="timeout" from="hit_shader_cooldown" to="." method="_on_hit_shader_cooldown_timeout"]
